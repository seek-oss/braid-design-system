language: node_js
cache: yarn
notifications:
  email: false

script:
  - yarn ci

after_success:
  - if [ ${TRAVIS_SECURE_ENV_VARS} = "true" ]; then
      yarn travis-deploy-once "yarn chromatic";

      if [ -n "$TRAVIS_PULL_REQUEST_SHA" ]; then
        yarn travis-deploy-once "yarn deploy-preview -- -d braid-design-system--${TRAVIS_PULL_REQUEST_SHA}.surge.sh";
        yarn travis-deploy-once "yarn post-commit-status";
      elif [ "$TRAVIS_BRANCH" == "master" ]; then
        git config --global user.name "seek-oss-ci";
        git config --global user.email "opensource@seek.com.au";
        yarn travis-deploy-once "yarn deploy";
      fi
    fi
branches:
  except:
    - /^v\d+\.\d+\.\d+$/
